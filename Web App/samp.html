<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Delete All Edges</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collectionGroup, getDocs, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { firebaseConfig } from "../firebaseConfig.js";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function clearAllEdges() {
      const logs = document.getElementById("logs");
      logs.textContent = "‚ö†Ô∏è Starting to remove all edges...\n";

      try {
        const querySnap = await getDocs(collectionGroup(db, "versions"));
        let count = 0;

        for (const versionDoc of querySnap.docs) {
          const versionRef = versionDoc.ref;
          await updateDoc(versionRef, { edges: [] });
          logs.textContent += `üóëÔ∏è Cleared edges for ${versionRef.path}\n`;
          count++;
        }

        logs.textContent += `\n‚úÖ Done! Removed edges from ${count} version documents.`;
      } catch (err) {
        logs.textContent += `\n‚ùå Error: ${err.message}`;
        console.error(err);
      }
    }

    window.runClear = clearAllEdges;
  </script>
</head>
<body style="font-family: Arial; padding: 20px;">
  <h2>Delete All Edges</h2>
  <p>This will permanently remove all <code>edges</code> data from every map version in your Firestore.</p>
  <p><b>Make sure you have a backup (like your MapVersions.json) before running!</b></p>
  <button onclick="runClear()" style="padding: 10px 20px; font-size: 16px; background:red; color:white; font-weight:bold;">Delete All Edges</button>
  <pre id="logs" style="margin-top:20px; background:#111; color:#0f0; padding:10px; height:400px; overflow-y:scroll;"></pre>
</body>
</html>
