<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Category Migration</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getFirestore, collection, getDocs, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

import { firebaseConfig } from "../firebaseConfig.js";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ================= RANDOM COLOR PICKER ==================
    function getRandomColor() {
      const colors = [
        "#e63946", "#f1a208", "#2a9d8f", "#264653", "#8d99ae",
        "#ffb703", "#118ab2", "#06d6a0", "#ef476f", "#1c71d8"
      ];
      return colors[Math.floor(Math.random() * colors.length)];
    }

    // ================= MIGRATION ==================
    async function migrateCategories() {
      try {
        const snap = await getDocs(collection(db, "Categories"));
        let migratedCount = 0;

        for (const docSnap of snap.docs) {
          const data = docSnap.data();

          // Only migrate docs that still have an icon
          if (data.icon && !data.color) {
            const newColor = getRandomColor();
            await updateDoc(doc(db, "Categories", docSnap.id), {
              color: newColor,
              icon: null // remove icon field (or you can delete it)
            });

            console.log(`✅ Migrated ${docSnap.id}: icon → color ${newColor}`);
            migratedCount++;
          }
        }

        alert(`Migration complete! Migrated ${migratedCount} categories.`);
      } catch (err) {
        console.error("❌ Migration failed:", err);
        alert("Migration failed, check console for details.");
      }
    }

    window.migrateCategories = migrateCategories;
  </script>
</head>
<body>
  <h2>Category Migration Tool</h2>
  <button onclick="migrateCategories()">Migrate Old Categories</button>
  <p>Click the button to replace old <code>icon</code> fields with random <code>color</code> fields.</p>
</body>
</html>
